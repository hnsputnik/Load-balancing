user  nginx;
worker_processes  auto;
worker_rlimit_nofile 100000;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
	multi_accept on;
	accept_mutex on;
	worker_connections 16384;
}

http {
	more_set_headers 'Server: VNDirect Securities Corporation';
	include       /etc/nginx/mime.types;
	default_type  application/octet-stream;
	log_format main '$http_host ' '$remote_addr [$time_local] ' '"$request" $status $body_bytes_sent ' '"$http_referer" "$http_user_agent" ' '$request_time ' '$upstream_response_time ' 'upstream: $upstream_addr';

	access_log  /var/log/nginx/access.log  main;

	open_file_cache max=200000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;

	sendfile            on;
	tcp_nopush          on;
	tcp_nodelay         on;
	server_tokens       off;
	gzip on;
    gzip_min_length 10240;
    gzip_comp_level 1;
    gzip_vary on;
    gzip_disable msie6;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types
        # text/html is always compressed by HttpGzipModule
        text/css
        text/javascript
        text/xml
        text/plain
        text/x-component
        application/javascript
        application/x-javascript
        application/json
        application/xml
        application/rss+xml
        application/atom+xml
        font/truetype
        font/opentype
        application/vnd.ms-fontobject
        image/svg+xml;
	server_name_in_redirect off;
	server_names_hash_bucket_size 512;
	proxy_buffering     on;
	proxy_buffer_size          256k;
	proxy_buffers              64 256k;
	proxy_busy_buffers_size    256k;
	proxy_temp_file_write_size 2048k;
	proxy_max_temp_file_size    1256m;
	proxy_headers_hash_max_size 2048;
	proxy_headers_hash_bucket_size 1024;
	client_body_buffer_size  512k;
	client_header_buffer_size 512;
	client_max_body_size 16M;
	large_client_header_buffers 64 512k;

	proxy_redirect off;
	proxy_set_header    X-NginX-Proxy true;
	proxy_set_header    Host $host;
	proxy_set_header    X-Real-IP  $remote_addr;
	proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header    X-Forwarded-Proto   $scheme;
	proxy_set_header    X-Forwarded-Host $host;
	proxy_set_header    X-Forwarded-Server $host;
	proxy_pass_header   Set-Cookie;
	proxy_pass_header   X-CSRF-TOKEN;
	proxy_pass_header   X-AUTH-TOKEN;
	proxy_hide_header   X-Powered-By;
	proxy_hide_header   X-AspNet-Version;
	reset_timedout_connection on;
	proxy_read_timeout  20s;
	proxy_send_timeout  20s;
	proxy_connect_timeout 20s;
	keepalive_timeout   20s;
	keepalive_requests  1000;
	send_timeout 20s;
	client_body_timeout 20s;
	client_header_timeout 20s;

	geo $limit {
		default 1;
		10.0.0.0/8 0;
		192.168.0.0/16 0;
		202.160.124.0/24 0;
		202.160.125.0/24 0;
		#Allow Public HCM
		103.238.72.45 0;
		113.161.65.54 0;
		115.78.164.78 0;
		14.161.26.127 0;
		183.91.28.240 0;
		210.245.36.131 0;
		#Allow Public HN
		103.238.68.163 0;
		118.70.129.31 0;
		103.37.29.134 0;
		203.128.245.222 0;
		14.160.32.66 0;
		#Allow Public DN
		113.160.224.226 0;
	}
	map $limit $limit_key {
		0 "";
		1 $binary_remote_addr;
	}

	limit_req_zone $limit_key zone=RateLimit:100m rate=250r/s;

	set_real_ip_from 127.0.0.1;
	real_ip_header    X-Forwarded-For;
	real_ip_recursive on;
	proxy_cache_path /var/www/nginx/cache levels=1:2 keys_zone=VNDS:100m max_size=2048m inactive=5m;
	proxy_temp_path /var/www/nginx/cache/tmp;  
	proxy_cache_key         $scheme://$host$request_uri$is_args$args;
	
	upstream finfoapistocks {
		server 10.200.31.11:8080;
		server 10.200.31.12:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream finfoapiprivate {
		server 10.200.31.81:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream finfov4priv {
		server 10.200.31.148:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream finfov4prod {
		server 10.200.31.149:8080;
		server 10.200.31.150:8080;
		server 10.200.31.163:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream finfoapipython {
		server 10.200.31.18:8000;
		server 10.200.31.48:8000;
		server 10.200.31.49:8000;
		server 10.200.31.50:8000;
		server 10.200.31.70:8000;
		#check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream finfotaskqueue {
		server 10.200.31.19:8000;
		#check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream stock_screener_api {
		server 10.200.31.32:8000;
		server 10.200.31.76:8000;
		#check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream stock_screener_job {
		server 10.200.31.33:8002;
		#check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream ssapi-web {
		server 10.200.31.56:8090;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream notisocketdolfin {
		ip_hash;
		server 10.200.31.124:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dchartapi {
		server 10.200.31.41:80;
		server 10.200.31.42:80;
		server 10.200.31.43:80;
		server 10.200.31.44:80;
		server 10.200.31.45:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}

	server {
		listen  80 reuseport;
		server_name     finfoapi.vndirect.com.vn finfoapi-hn.vndirect.com.vn finfo-api.vndirect.com.vn chart-api.vndirect.com.vn margin-api.vndirect.com.vn product-hn.vndirect.com.vn sales.vndirect.com.vn brokers.vndirect.com.vn moigioi.vndirect.com.vn product-api.vndirect.com.vn broker-api.vndirect.com.vn customer-admin.vndirect.com.vn customer-profile.vndirect.com.vn customer-profile-beta.vndirect.com.vn ads-admin.vndirect.com.vn finfo-task-queue.vndirect.com.vn stock-screener-api.vndirect.com.vn stock-screener-jobs.vndirect.com.vn crms.vndirect.com.vn finfov4-in.vndirect.com.vn finfov4-api-staging.vndirect.com.vn finfov4-in-staging.vndirect.com.vn finfov4-api.vndirect.com.vn finfov4-in.vndirect.com.vn noti-dolfin.vndirect.com.vn dchart-api.vndirect.com.vn myaccount.vndirect.com.vn bondclient.vndirect.com.vn;
		access_log  /var/log/nginx/access.log  main;

		location /nginx_status {
			stub_status on;
			access_log   off;
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 192.168.0.0/16;
			allow 202.160.124.0/24;
			allow 202.160.125.0/24;
			deny all;
		}

		location / {
			limit_req zone=RateLimit burst=300 nodelay; 
			return 301 https://$host$request_uri;
		}
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		location = /errorpage.html {
			root /var/www/nginx/;
			access_log off;
			expires 30d;
		}
	}

	server {
		listen 443 ssl reuseport;
		server_name	finfo-api.vndirect.com.vn finfoapi-hn.vndirect.com.vn finfoapi.vndirect.com.vn;
		include conf.d/ssl.conf;
		
		access_log  /var/log/nginx/access.log  main;

		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location = /errorpage.html {
			root /var/www/nginx/;
			access_log off;
			expires 30d;
		}
		location = /contactjson.html {
			root /var/www/nginx;
		}
		if ( $host = 'finfo-api.vndirect.com.vn' ) {
			set $filter FinfoApi;
		}
		if ( $host = 'finfoapi-hn.vndirect.com.vn' ) {
			set $filter FinfoApi;
		}
		if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
			set $filter FinfoApiPrivate;
		}
		location ~ ^/v3/stocks/recommendation? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/stocks/personnel? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/stocks/companyForecast? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/stocks/derivatives? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			proxy_pass http://finfoapipython; 
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/derivatives/mapping? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;   
			proxy_pass http://finfoapipython; 
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/stocks/intraday/history? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/trade/derivatives/dchart? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 10s;
			expires 10s;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/stocks/intraday? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 10s;
			expires 10s;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3/index/securities/vnmarket/intraday? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 10s;
			expires 10s;                                          
			proxy_pass http://finfoapipython;       
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v3(/)? {                     
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://finfoapipython;       
			proxy_hide_header 'Cache-Control';       
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;                        
			proxy_intercept_errors off;                
		}
		location ~ ^/v4/recommendations {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/personnel {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/industry_classification {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/shareholders {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/companyForecast {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/stocks? {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/derivative_mappings? {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/derivatives? {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/exporting {
			limit_req zone=RateLimit burst=300 nodelay;      
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}                                        
			if ( $filter ~ "^(FinfoApi)$" ){
				return 403;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/macro_interests? {
			limit_req zone=RateLimit burst=300 nodelay;  
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			} 
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/currencies? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/commodities? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/ratios? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/top_of_stocks? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 10s;
			expires 10s;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/foreigns? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 10s;
			expires 10s;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/events {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 1m;
			expires 1m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/effective_secinfo  {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 30s;
			expires 1m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/news {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 1m;
			expires 1m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/indexs {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/attachments {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/trading_statistics {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/interested_stocks {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 10s;
			expires 10s;                                          
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}         
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4/dstock_votings? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://10.200.31.148:80;        
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;              
		}
		location ~ ^/v4(/)? {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfov4prod;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfov4priv;
			}                                                   
			proxy_hide_header 'Cache-Control';       
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;                        
			proxy_intercept_errors off;                
		}
		location /industries {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;
			if ($remote_addr ~ "^(118\.69\.180\.45|202\.87\.212\.4|113\.22\.41\.156|118\.69\.120\.9|14\.161\.0\.45|171\.253\.19\.189|222\.255\.28\.68|222\.255\.28\.75|222\.255\.28\.23|14\.169\.14\.26|58\.187\.164\.112)$") {
				return 301 https://$host/contactjson.html;
			}
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfoapistocks;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfoapiprivate;
			}
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;
		}
		location ~ ^/stock(.*) {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;
			if ($remote_addr ~ "^(118\.69\.180\.45|202\.87\.212\.4|113\.22\.41\.156|118\.69\.120\.9|14\.161\.0\.45|171\.253\.19\.189|222\.255\.28\.68|222\.255\.28\.75|222\.255\.28\.23|14\.169\.14\.26|58\.187\.164\.112)$") {
				return 301 https://$host/contactjson.html;
			}
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfoapistocks;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfoapiprivate;
			}
			add_header Pragma "public";
			add_header Cache-Control "public, must-revalidate, proxy-revalidate";
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,Pragma,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;
		}
		location ~ /time {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($remote_addr ~ "^(118\.69\.180\.45|202\.87\.212\.4|113\.22\.41\.156|118\.69\.120\.9|14\.161\.0\.45|171\.253\.19\.189|222\.255\.28\.68|222\.255\.28\.75|222\.255\.28\.23|14\.169\.14\.26|58\.187\.164\.112)$") {
				return 301 https://$host/contactjson.html;
			}
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfoapistocks;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfoapiprivate;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			proxy_intercept_errors off;
		}
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ($remote_addr ~ "^(118\.69\.180\.45|202\.87\.212\.4|113\.22\.41\.156|118\.69\.120\.9|14\.161\.0\.45|171\.253\.19\.189|222\.255\.28\.68|222\.255\.28\.75|222\.255\.28\.23|14\.169\.14\.26|58\.187\.164\.112)$") {
				return 301 https://$host/contactjson.html;
			}
			if ( $filter ~ "^(FinfoApi)$" ){
				proxy_pass http://finfoapistocks;
			}
			if ( $filter ~ "^(FinfoApiPrivate)$" ){
				proxy_pass http://finfoapiprivate;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name stock-screener-api.vndirect.com.vn stock-screener-jobs.vndirect.com.vn ssapi.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;


		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			#if ($request_method = 'OPTIONS') {
			#	more_set_headers 'Access-Control-Max-Age: 1728000';
			#	more_set_headers 'Content-Type: text/plain; charset=UTF-8';
			#	more_set_headers 'Content-Length: 0';
			#	return 200;
			#}
			if ( $host = 'stock-screener-api.vndirect.com.vn' ) {                              
				proxy_pass  http://stock_screener_api;
			}
			if ( $host = 'stock-screener-jobs.vndirect.com.vn' ) {
				proxy_pass  http://stock_screener_job;
			}
			add_header 'Access-Control-Max-Age' 600;                                
			add_header 'Access-Control-Allow-Origin' '*' always;                                
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, branch-id, token-id, token' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate"; 
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
		}
	}
	
	server {
		listen 443 ssl;
		server_name crms.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;


		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://ssapi-web;
				#return 302 https://maintain.vndirect.com.vn;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://ssapi-web;
				#return 302 https://maintain.vndirect.com.vn;
			}
			add_header 'Access-Control-Max-Age' 600;                                
			add_header 'Access-Control-Allow-Origin' '*' always;                                
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, branch-id, token-id, token' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate"; 
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
		}
	}
	server {
		listen 443 ssl;
		server_name finfo-task-queue.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		location /reload {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			allow 192.168.69.0/24;
			allow 10.200.34.9/32;
			allow 10.200.30.3/32;
            allow 10.25.1.0/24;
            allow 202.160.125.0/24;
            allow 202.160.124.0/24;
            deny all;
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Credentials' 'true'; 
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;                        
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_pass  http://finfotaskqueue;                         
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
		}
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Credentials' 'true'; 
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;                        
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_pass  http://finfotaskqueue;                         
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name finfov4-api-staging.vndirect.com.vn finfov4-in-staging.vndirect.com.vn;
		proxy_next_upstream off;        
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			limit_req zone=RateLimit burst=20 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $host = 'finfov4-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.146:8080;
			}
			if ( $host = 'finfov4-in-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.146:80;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,X-AUTH-USERNAME,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,token-id,x-idempotencykey,x-maker,x-via' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;                
		}       
	}

	server {
		listen 443 ssl;
		server_name finfov4-in.vndirect.com.vn;
		proxy_next_upstream off;        
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			allow 127.0.0.1;
			allow 10.200.34.7;
			allow 10.200.34.9;
			allow 10.200.30.3;
			deny all;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $host = 'finfov4-in.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.148:80;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,X-AUTH-USERNAME,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,token-id,x-idempotencykey,x-maker,x-via' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;                
		}       
	}

	server {
		listen 443 ssl;
		server_name noti-dolfin.vndirect.com.vn;
		proxy_next_upstream off;
		
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/; 
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		location / {
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			limit_req zone=RateLimit burst=20 nodelay;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
			proxy_set_header Host $host;
			add_header X-Frame-Options ALLOWALL;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_pass http://notisocketdolfin;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			#add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;                        
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name bondclient.vndirect.com.vn;
		proxy_next_upstream off;
		
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/; 
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		location / {
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			limit_req zone=RateLimit burst=20 nodelay;
			if ( $host = 'bondclient.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.97:9090;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;                        
			proxy_intercept_errors off;
		}
	}
	server {
		listen 443 ssl;
		server_name myaccount.vndirect.com.vn;
		proxy_next_upstream off;
		
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/; 
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		location / {
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			limit_req zone=RateLimit burst=20 nodelay;
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://10.200.31.96:9000;
				#return 302 https://maintain.vndirect.com.vn;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://10.200.31.96:9000;
				#return 302 https://maintain.vndirect.com.vn;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;                        
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name	dchart-api.vndirect.com.vn;
		include conf.d/ssl.conf;

		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location = /errorpage.html {
			root /var/www/nginx/;
			access_log off;
			expires 30d;
		}
		location = /contactjson.html {
			limit_req zone=RateLimit burst=20 nodelay;
			root /var/www/nginx;
		}
		location = /dchart/time {
			limit_req zone=RateLimit burst=20 nodelay;
			proxy_pass http://dchartapi;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true' always;
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;                
		}
		location ~ /dchart {
			limit_req zone=RateLimit burst=20 nodelay;
			set $cors "";

			if ($http_origin ~* (.*\.vndirect\.com\.vn)) {
				set $cors "true";
			}
			if ($http_origin ~* (.*\.fnsyrus\.com)) {
				set $cors "true";
			}
			if ($http_origin ~* (vninvest\.bualuang\.co\.th)) {
				set $cors "true";
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $http_origin "*";
				set $cors "true";
			}
			if ( $http_user_agent ~ "^(VndirectAndroidApp)(.*)?$" ) {
				set $http_origin "*";
				set $cors "true";
			}
			if ( $http_user_agent ~ "^(VndirectDesktopApp)(.*)?$" ) {
				set $http_origin "*";
				set $cors "true";
			}
			# if ($request_method = OPTIONS) {
			# 	add_header 'Access-Control-Allow-Origin' "$http_origin" always;
			#	add_header 'Access-Control-Max-Age' 1728000;
			#	add_header 'Content-Type' 'text/plain charset=UTF-8';
			#	add_header 'Content-Length' 0;
			#	return 200;
			#}    
			if ($cors = 'true') {
				add_header 'Access-Control-Allow-Origin' "$http_origin" always;
				add_header 'Access-Control-Allow-Credentials' 'true' always;
				add_header 'Access-Control-Max-Age' 600;
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			}
			add_header X-Proxy-Cache $upstream_cache_status;
			proxy_cache             VNDS;
			proxy_cache_valid       200 302 304 5m;
			expires 5m;
			proxy_pass http://dchartapi;
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;                
		}    
		location / {
			limit_req zone=RateLimit burst=20 nodelay;
			set $cors "";

			if ($http_origin ~* (.*\.vndirect\.com\.vn)) {
				set $cors "true";
			}
			if ($http_origin ~* (.*\.fnsyrus\.com)) {
				set $cors "true";
			}
			if ($http_origin ~* (vninvest\.bualuang\.co\.th)) {
				set $cors "true";
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $http_origin "*";
				set $cors "true";
			}
			if ( $http_user_agent ~ "^(VndirectAndroidApp)(.*)?$" ) {
				set $http_origin "*";
				set $cors "true";
			}
			if ( $http_user_agent ~ "^(VndirectDesktopApp)(.*)?$" ) {
				set $http_origin "*";
				set $cors "true";
			}
			#if ($request_method = OPTIONS) {
			#	add_header 'Access-Control-Allow-Origin' "$http_origin" always;
			#	add_header 'Access-Control-Max-Age' 1728000;
			#	add_header 'Content-Type' 'text/plain charset=UTF-8';
			#	add_header 'Content-Length' 0;
			#	return 200;
			#}
			if ($cors = 'true') {
				add_header 'Access-Control-Allow-Origin' "$http_origin" always;
				add_header 'Access-Control-Allow-Credentials' 'true' always;
				add_header 'Access-Control-Max-Age' 600;
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
				add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			}
			if ($remote_addr ~ "^(221\.132\.36\.39)$") {
				return 301 https://$host/contactjson.html;
			}
			proxy_pass http://dchartapi;
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
		}
	}
}
