user  nginx;
worker_processes  auto;
worker_rlimit_nofile 100000;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
	multi_accept on;
	accept_mutex on;
	worker_connections 16384;
}

http {
	more_set_headers 'Server: VNDirect Securities Corporation';
	include       /etc/nginx/mime.types;
	default_type  application/octet-stream;
	log_format main '$http_host ' '$remote_addr [$time_local] ' '"$request" $status $body_bytes_sent ' '"$http_referer" "$http_user_agent" ' '$request_time ' '$upstream_response_time ' 'upstream: $upstream_addr';

	access_log  /var/log/nginx/access.log  main;

	open_file_cache max=200000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;

	sendfile            on;
	tcp_nopush          on;
	tcp_nodelay         on;
	server_tokens       off;
	gzip on;
    gzip_min_length 10240;
    gzip_comp_level 1;
    gzip_vary on;
    gzip_disable msie6;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types
        # text/html is always compressed by HttpGzipModule
        text/css
        text/javascript
        text/xml
        text/plain
        text/x-component
        application/javascript
        application/x-javascript
        application/json
        application/xml
        application/rss+xml
        application/atom+xml
        font/truetype
        font/opentype
        application/vnd.ms-fontobject
        image/svg+xml;
	server_name_in_redirect off;
	server_names_hash_bucket_size 512;
	proxy_buffering     on;
	proxy_buffer_size          256k;
	proxy_buffers              64 256k;
	proxy_busy_buffers_size    256k;
	proxy_temp_file_write_size 2048k;
	proxy_max_temp_file_size    1256m;
	proxy_headers_hash_max_size 2048;
	proxy_headers_hash_bucket_size 1024;
	client_body_buffer_size  512k;
	client_header_buffer_size 512;
	client_max_body_size 50M;
	large_client_header_buffers 64 512k;

	proxy_redirect off;
	proxy_set_header    X-NginX-Proxy true;
	proxy_set_header    Host $host;
	proxy_set_header    X-Real-IP  $remote_addr;
	proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header    X-Forwarded-Proto   $scheme;
	proxy_set_header    X-Forwarded-Host $host;
	proxy_set_header    X-Forwarded-Server $host;
	proxy_pass_header   Set-Cookie;
	proxy_pass_header   X-CSRF-TOKEN;
	proxy_pass_header   X-AUTH-TOKEN;
	proxy_hide_header   X-Powered-By;
	proxy_hide_header   X-AspNet-Version;
	reset_timedout_connection on;
	proxy_read_timeout  30s;
	proxy_send_timeout  30s;
	proxy_connect_timeout 30s;
	keepalive_timeout   30s;
	keepalive_requests  1000;
	send_timeout 30s;
	client_body_timeout 30s;
	client_header_timeout 30s;

	geo $limit {
		default 1;
		10.0.0.0/8 0;
		192.168.0.0/16 0;
		202.160.124.0/24 0;
		202.160.125.0/24 0;
		#Allow Public HCM
		103.238.72.45 0;
		113.161.65.54 0;
		115.78.164.78 0;
		14.161.26.127 0;
		183.91.28.240 0;
		210.245.36.131 0;
		#Allow Public HN
		103.238.68.163 0;
		118.70.129.31 0;
		103.37.29.134 0;
		203.128.245.222 0;
		14.160.32.66 0;
		#Allow Public DN
		113.160.224.226 0;
	}
	map $limit $limit_key {
		0 "";
		1 $binary_remote_addr;
	}

	limit_req_zone $limit_key zone=RateLimit:100m rate=250r/s;

	set_real_ip_from 127.0.0.1;
	real_ip_header    X-Forwarded-For;
	real_ip_recursive on;
	proxy_cache_path /var/www/nginx/cache levels=1:2 keys_zone=VNDS:100m max_size=2048m inactive=5m;
	proxy_temp_path /var/www/nginx/cache/tmp;  
	proxy_cache_key         $scheme://$host$request_uri$is_args$args;
	
	upstream guacamole {
		ip_hash;
		server 10.200.34.3:8080;
		#server 10.200.34.4:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream guacamoleivnd {
		server 10.200.34.3:8080;
		#server 10.200.34.4:8080;
		#server 10.200.34.5:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	map $http_upgrade $connection_upgrade {
		default upgrade;
		'' close;
	}

    upstream dchartsocket {
		ip_hash;
		server 10.200.32.113:8090;
		server 10.200.32.119:8090;
		server 10.200.32.120:8090;
		server 10.200.32.121:8090;
		check interval=2000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream dchartsocketversion {
		ip_hash;
		server 10.200.32.113:8080;
		server 10.200.32.119:8080;
		server 10.200.32.120:8080;
		server 10.200.32.121:8080;
		check interval=2000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream dchartsocketstag {
		#ip_hash;
		server 10.200.32.83:8090;
		check interval=2000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream dchartsocketversionstag {
		#ip_hash;
		server 10.200.32.83:8080;
		check interval=2000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream sentry  {
		server 10.200.32.91:9000;
		server 10.200.32.92:9000;
		server 10.200.32.93:9000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dpost {
		server 10.200.32.5:1508;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream nhanhaweb {
		server 10.200.31.79:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream nhanhapublicapi {
		server 10.200.31.80:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream nhanhav3api {
		server 10.200.31.80:8088;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dtradepro {
		server 10.200.32.74:8080;
		server 10.200.32.75:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dtradeproprivate {
		server 10.200.32.76:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dmaweb {
		server 10.200.31.91:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dmauserapi {
		server 10.200.31.90:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dmaapi {
		server 10.200.31.89:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream bondapi {
		server 10.200.31.83:8080;
		server 10.200.31.152:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream onlineaccountapi {
		server 10.200.31.94:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream serviceproductapi {
		server 10.200.31.95:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tttvapi {
		server 10.200.31.102:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream registryapi {
		ip_hash;
		server 10.200.31.105:8080;
		server 10.200.31.166:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream registryweb {
		server 10.200.31.120:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream leadidapi {
		server 10.200.31.108:8082;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream ivndleadapi {
		server 10.200.31.108:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}	
	upstream dcommunicationgwapi {
		server 10.200.31.162:8089;
		server 10.200.31.167:8089;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream leadidgwapi {
		server 10.200.31.108:8083;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}	
	upstream leadidadmin {
		server 10.200.31.108:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dertrial {
		server 10.200.31.99:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dtradetrial {
		server 10.200.31.116:8080;
		server 10.200.31.117:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dertrialapi {
		server 10.200.31.98:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dchartv3stag {
		server 10.200.32.83:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream dchartv3 {
		server 10.200.32.112:3000;
		server 10.200.32.118:3000;
		server 10.200.32.134:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream chartapi {
		server 10.200.32.135:8080;
		#check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream mkwclient {
		server 10.200.31.119:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream mkwsocket {
		ip_hash;
		server 10.200.31.119:8090;
		check interval=2000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream mkwsocketversion {
		ip_hash;
		server 10.200.31.119:8080;
		check interval=2000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream ccqapi {
		server 10.200.32.109:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream ccqgw {
		server 10.200.32.110:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream ccqadmin {
		server 10.200.32.111:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream brokerapi {
		server 10.200.31.66:8090;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream brokerinsightapi  {
		server 10.200.31.112:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream cpknapi {
		server 10.200.32.115:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream reportingservicegateway {
		server 10.200.31.118:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream vndid-app {
		ip_hash;
		server 10.200.31.73:8080;
		server 10.200.31.185:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream vndid-appprivate {
		server 10.200.31.138:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream reportingintapi {
		server 10.200.13.181:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream useridprod {
		server 10.200.31.141:8080;
		server 10.200.31.142:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream vndidprod {
		server 10.200.31.143:8080;
		server 10.200.31.144:8080;
		server 10.200.31.168:8080;
		server 10.200.31.169:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream useridpriv {
		server 10.200.31.145:8080;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	
	server {
		listen  80 reuseport;
		server_name  dlawapi.vndirect.com.vn vnds-fileservice.vndirect.com.vn dlegal.vndirect.com.vn chart-api.vndirect.com.vn pms.vndirect.com.vn pms-api.vndirect.com.vn dgo-api.vndirect.com.vn dor.vndirect.com.vn dor-stagging.vndirect.com.vn suckhoetaichinh-stag.vndirect.com.vn registry-api-staging.vndirect.com.vn trade.vndirect.com.vn crms.vndirect.com.vn myaccount.vndirect.com.vn accounts.vndirect.com.vn onboarding.vndirect.com.vn dwealth.vndirect.com.vn contact.vndirect.com.vn maintain.vndirect.com.vn piwik.vndirect.com.vn pricelist.vndirect.com.vn quiz.vndirect.com.vn vdi.vndirect.com.vn vdi-ivnd.vndirect.com.vn marketwatch.vndirect.com.vn survey-adm.vndirect.com.vn form.vndirect.com.vn  dcommunication-gw-api.vndirect.com.vn userid.vndirect.com.vn userid-priv.vndirect.com.vn vndid-int-api.vndirect.com.vn dwealth-api-staging.vndirect.com.vn tichsan-stag.vndirect.com.vn protrade.vndirect.com.vn tichsan.vndirect.com.vn suckhoetaichinh.vndirect.com.vn accounts-staging.vndirect.com.vn dwealthplanning.vndirect.com.vn dhome.vndirect.com.vn workflow-api-staging.vndirect.com.vn ob-api.vndirect.com.vn static-dhome.vndirect.com.vn cdn-dhome.vndirect.com.vn dhome-api.vndirect.com.vn workflow-api.vndirect.com.vn cimb-wl-gateway.vndirect.com.vn reporting-internal-api.vndirect.com.vn id.vndirect.com.vn mkw.vndirect.com.vn mkw-socket.vndirect.com.vn reporting-service-api.vndirect.com.vn wl-account-api.vndirect.com.vn whitelabel-account.vndirect.com.vn protrade-trial.vndirect.com.vn ivnd-leadid-api.vndirect.com.vn broker-insight-api.vndirect.com.vn dpost.vndirect.com.vn nhanha-v3.vndirect.com.vn nhanha-public-api.vndirect.com.vn dtradepro-beta.vndirect.com.vn dtradepro.vndirect.com.vn dma.ivnd.com.vn dma.ivnd.com.vn dma-beta.ivnd.com.vn dma-api.ivnd.com.vn dma-user-api.ivnd.com.vn bond-api.vndirect.com.vn service-product-api.vndirect.com.vn online-account-api.vndirect.com.vn tttv-api.vndirect.com.vn tttv-api-staging.vndirect.com.vn dertrial.vndirect.com.vn dertrial-api.vndirect.com.vn nhanha-v3-api.vndirect.com.vn registry-api.vndirect.com.vn online-account-api-staging.vndirect.com.vn service-product-api-staging.vndirect.com.vn taggingid-api.vndirect.com.vn taggingid-gw-api.vndirect.com.vn taggingid-admin.vndirect.com.vn leadid-api.vndirect.com.vn leadid-gw-api.vndirect.com.vn leadid-admin.vndirect.com.vn dchart-v3-staging.vndirect.com.vn gray.vndirect.com.vn dchart-socket-staging.vndirect.com.vn dchart.vndirect.com.vn dchart-socket.vndirect.com.vn fundstock-api.vndirect.com.vn fundstock-gw.vndirect.com.vn fundstock.vndirect.com.vn broker-api.vndirect.com.vn cpkn-api.vndirect.com.vn;
		access_log  /var/log/nginx/access.log  main;
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location /nginx_status {
			stub_status on;
			access_log   off;
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 192.168.0.0/16;
			allow 202.160.124.0/24;
			allow 202.160.125.0/24;
			deny all;
		}

		location = /errorpage.html {
						root /var/www/nginx/;
						access_log off;
						expires 30d;
		}
		location / {
			return 301 https://$host$request_uri;
		}
		
	}
	
	server {
        listen  80;
        server_name  sentry.vndirect.com.vn;
        access_log  /var/log/nginx/access.log  main;

        location / {
			if ($request_method = GET) {
				rewrite  ^ https://$host$request_uri permanent;
			}
			return 405;
		}
	}
	
	server {
		listen 443 ssl reuseport;
		server_name pms.vndirect.com.vn pms-api.vndirect.com.vn dgo-api.vndirect.com.vn suckhoetaichinh-stag.vndirect.com.vn form.vndirect.com.vn dcommunication-gw-api.vndirect.com.vn dwealth-api-staging.vndirect.com.vn tichsan-stag.vndirect.com.vn tichsan.vndirect.com.vn accounts-staging.vndirect.com.vn dhome.vndirect.com.vn workflow-api-staging.vndirect.com.vn static-dhome.vndirect.com.vn cdn-dhome.vndirect.com.vn dhome-api.vndirect.com.vn workflow-api.vndirect.com.vn wl-gateway.vndirect.com.vn reporting-internal-api.vndirect.com.vn wl-account-api.vndirect.com.vn whitelabel-account.vndirect.com.vn protrade-trial.vndirect.com.vn ivnd-leadid-api.vndirect.com.vn broker-insight-api.vndirect.com.vn dpost.vndirect.com.vn nhanha-v3.vndirect.com.vn nhanha-public-api.vndirect.com.vn nhanha-v3-api.vndirect.com.vn dtradepro-beta.vndirect.com.vn dtradepro.vndirect.com.vn bond-api.vndirect.com.vn service-product-api.vndirect.com.vn online-account-api.vndirect.com.vn dertrial.vndirect.com.vn online-account-api-staging.vndirect.com.vn service-product-api-staging.vndirect.com.vn taggingid-api.vndirect.com.vn gray.vndirect.com.vn taggingid-gw-api.vndirect.com.vn taggingid-admin.vndirect.com.vn leadid-api.vndirect.com.vn leadid-gw-api.vndirect.com.vn leadid-admin.vndirect.com.vn broker-api.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		proxy_http_version 1.1;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ( $host = 'mkw.vndirect.com.vn' ) {
				proxy_pass http://mkwclient;
			}
			if ( $host = 'dpost.vndirect.com.vn' ) {
                proxy_pass http://dpost;
            }
			if ( $host = 'nhanha-v3.vndirect.com.vn' ) {
                proxy_pass http://nhanhaweb;
            }
			if ( $host = 'nhanha-public-api.vndirect.com.vn' ) {
				proxy_pass http://nhanhapublicapi;
            }
			if ( $host = 'nhanha-v3-api.vndirect.com.vn' ) {
				proxy_pass http://nhanhav3api;
            }
			if ( $host = 'dtradepro.vndirect.com.vn' ) {
				return 301 https://protrade.vndirect.com.vn;
            }
			if ( $host = 'dtradepro-beta.vndirect.com.vn' ) {
				return 301 https://protrade.vndirect.com.vn;
            }
			if ( $host = 'bond-api.vndirect.com.vn' ) {
				proxy_pass http://bondapi;
            }
			if ( $host = 'online-account-api.vndirect.com.vn' ) {
				proxy_pass http://onlineaccountapi;
            }
			if ( $host = 'service-product-api.vndirect.com.vn' ) {
				proxy_pass http://serviceproductapi;
            }
			if ( $host = 'static-dhome.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.123:80;
            } 
			if ( $host = 'cdn-dhome.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.123:5000;
            }
			if ( $host = 'online-account-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.106:8080;
            }
			if ( $host = 'wl-account-api.vndirect.com.vn' ) {
				proxy_pass http://10.200.13.170:80;
            }
			if ( $host = 'wl-gateway.vndirect.com.vn' ) {
				proxy_pass http://10.200.13.165:8080;
            }
			if ( $host = 'whitelabel-account.vndirect.com.vn' ) {
				proxy_pass http://10.200.13.170:8080;
            }
			if ( $host = 'service-product-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.106:8081;
            }
			if ( $host = 'workflow-api.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.126:8080;
            }
			if ( $host = 'workflow-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.106:8508;
            }
			if ( $host = 'dhome-api.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.123:8080;
            }
			if ( $host = 'dhome.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.123:3000;
            }
			if ( $host = 'dwealth-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.127:8080;
            }
			if ( $host = 'tichsan-stag.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.127:3039;
            }
			if ( $host = 'tichsan.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.126:3039;
            }
			if ( $host = 'gray.vndirect.com.vn' ) {
				add_header Host $http_host;
				add_header X-Forwarded-Host $host;
				add_header X-Forwarded-Server $host;
				#add_headerX-Forwarded-For $proxy_add_x_forwarded_for;
				add_header X-Graylog-Server-URL https://$server_name/api;
                proxy_pass http://10.200.11.27:9000;
            }
			if ( $host = 'suckhoetaichinh-stag.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.127:3019;
            }
			if ( $host = 'dcommunication-gw-api.vndirect.com.vn' ) {
				proxy_pass http://dcommunicationgwapi;
            }
			if ( $host = 'leadid-api.vndirect.com.vn' ) {
				proxy_pass http://leadidapi;
            }
			if ( $host = 'ivnd-leadid-api.vndirect.com.vn' ) {
				proxy_pass http://ivndleadapi;
            }
			if ( $host = 'leadid-gw-api.vndirect.com.vn' ) {
				proxy_pass http://leadidgwapi;
            }
			if ( $host = 'leadid-admin.vndirect.com.vn' ) {
				proxy_pass http://leadidadmin;
            }
			if ( $host = 'accounts-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.106:3000;
            }
			if ( $host = 'dertrial.vndirect.com.vn' ) {
				return 301 https://protrade-trial.vndirect.com.vn;
            }
			if ( $host = 'protrade-trial.vndirect.com.vn' ) {
				proxy_pass http://dtradetrial;
            }
			if ( $host = 'broker-api.vndirect.com.vn' ) {
				proxy_pass http://brokerapi;
            }
			if ( $host = 'broker-insight-api.vndirect.com.vn' ) {
				proxy_pass http://brokerinsightapi;
            }
			if ( $host = 'reporting-internal-api.vndirect.com.vn' ) {
				proxy_pass http://reportingintapi;
            }
			if ( $host = 'form.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.129:8080;
            }
			if ( $host = 'pms-api.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.181:9091;
			}
			if ( $host = 'pms.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.189:3000;
			}
			if ( $host = 'dgo-api.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.183:9092;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;                
		}       
	}
	server {
		listen 443 ssl;
		server_name tttv-api.vndirect.com.vn tttv-api-staging.vndirect.com.vn;
		include conf.d/ssl.conf;
		proxy_http_version 1.1;
		proxy_next_upstream off;
		proxy_read_timeout  50s;
		proxy_send_timeout  50s;
		proxy_connect_timeout 50s;
		keepalive_timeout   50s;
		send_timeout 50s;
		client_body_timeout 50s;
		client_header_timeout 50s;
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ( $host = 'tttv-api.vndirect.com.vn' ) {
				proxy_pass http://tttvapi;
            }
			if ( $host = 'tttv-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.104:8080;
            }
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;                
		}       
	}
	server {
		listen 443 ssl;
		server_name suckhoetaichinh.vndirect.com.vn ob-api.vndirect.com.vn dwealthplanning.vndirect.com.vn;
		proxy_next_upstream off;
		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location / {
			if ($request_method = 'OPTIONS') {
					add_header "Access-Control-Allow-Origin"  '*' always;
					add_header "Access-Control-Allow-Methods" "GET, POST, OPTIONS, HEAD, PUT, PATCH, DELETE";
					add_header "Access-Control-Allow-Headers" "Authorization, Origin, X-Requested-With, Content-Type, Accept";
					more_set_headers 'Access-Control-Max-Age: 1728000';
					more_set_headers 'Content-Type: text/plain; charset=UTF-8';
					more_set_headers 'Content-Length: 0';
					return 204;
			}
			if ( $host = 'suckhoetaichinh.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.125:3000;
            }
			if ( $host = 'ob-api.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.125:8080;
            }
			if ( $host = 'dwealthplanning.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.125:3000;
            }
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,X-AUTH-USERNAME,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,token-id,x-idempotencykey,x-maker,x-via' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
	}
	
	server {
		listen 443 ssl;
		server_name reporting-service-api.vndirect.com.vn cimb-wl-gateway.vndirect.com.vn registry-api-staging.vndirect.com.vn;
		proxy_next_upstream off;
		include conf.d/ssl.conf;
		proxy_http_version 1.1;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
					more_set_headers 'Access-Control-Max-Age: 1728000';
					more_set_headers 'Content-Type: text/plain; charset=UTF-8';
					more_set_headers 'Content-Length: 0';
					return 200;
			}
			if ( $host = 'cimb-wl-gateway.vndirect.com.vn' ) {
				proxy_pass http://10.200.13.192:8080;
            }
			if ( $host = 'reporting-service-api.vndirect.com.vn' ) {
				proxy_pass http://reportingservicegateway;
            }
			if ( $host = 'registry-api-staging.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.106:8089;
            }
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,x-requested-with,X-DEVICE-ID,X-TRADE-OTP' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
    }
	server {
		listen 443 ssl;
		server_name registry-api.vndirect.com.vn;
		proxy_next_upstream off;
		include conf.d/ssl.conf;
		proxy_http_version 1.1;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		#error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location = /customers/basic-info {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
					more_set_headers 'Access-Control-Max-Age: 1728000';
					more_set_headers 'Content-Type: text/plain; charset=UTF-8';
					more_set_headers 'Content-Length: 0';
					return 200;
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				return 400;
			}
			proxy_pass http://registryapi;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,x-requested-with,X-DEVICE-ID,X-TRADE-OTP' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}

		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
					more_set_headers 'Access-Control-Max-Age: 1728000';
					more_set_headers 'Content-Type: text/plain; charset=UTF-8';
					more_set_headers 'Content-Length: 0';
					return 200;
			}
			proxy_pass http://registryapi;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,x-requested-with,X-DEVICE-ID,X-TRADE-OTP' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
    }

	server {
		listen 443 ssl;
		server_name dertrial-api.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location ~ /realtime {
			limit_req zone=RateLimit burst=300 nodelay;
			proxy_pass            http://dertrialapi;
			# websocket support
			proxy_http_version    1.1;
			proxy_set_header      Upgrade "websocket";
			proxy_set_header      Connection "Upgrade";
			proxy_read_timeout    86400;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
	}  
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			proxy_pass            http://dertrialapi;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;  
		}
	}

	server {
		listen 443 ssl;
		server_name accounts.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		proxy_http_version 1.1;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://registryweb;
				#return 302 https://maintain.vndirect.com.vn;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://registryweb;
				#return 302 https://maintain.vndirect.com.vn;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;  
		}
	}	
	server {
		listen 443 ssl;
		server_name protrade.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://dtradepro;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://dtradeproprivate;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,x-requested-with,Authentication' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
	}
	
	server {
		listen          443 ssl;
		server_name cpkn-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
		#more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $host = 'cpkn-api.vndirect.com.vn' ) {
				set $filter CPKN;
			}
			if ( $http_origin ~ "^(.*\.vndirect\.com\.vn)$" ) {
				set $filter "${filter}VND";
				proxy_pass http://cpknapi;
			}
			if ( $filter = "CPKNVND" ){
				proxy_pass http://cpknapi;
			}
			proxy_intercept_errors off;
				proxy_pass http://cpknapi;
		}
	}
	server {
		listen 443 ssl;
		server_name dma.ivnd.com.vn dma-beta.ivnd.com.vn dma.ivnd.com.vn dma-api.ivnd.com.vn dma-user-api.ivnd.com.vn;
		proxy_next_upstream off;                
		include conf.d/sslivnd.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = 'OPTIONS') {
				#more_set_headers 'Access-Control-Allow-Origin: *';
				#more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				#more_set_headers 'Access-Control-Allow-Credentials: true';
				#more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $host = 'dma-beta.ivnd.com.vn' ) {
				return 302 https://dma.ivnd.com.vn;
			}
			if ( $host = 'dma.ivnd.com.vn' ) {
				proxy_pass http://dmaweb;
			}
			if ( $host = 'dma-api.ivnd.com.vn' ) {
				proxy_pass http://dmaapi;
			}
			if ( $host = 'dma-user-api.ivnd.com.vn' ) {
				proxy_pass http://dmauserapi;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off; 
		}  
	}
	server {
		listen 443 ssl;
		server_name mkw-socket.vndirect.com.vn;              	
		proxy_next_upstream off;
		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location ~ /mkwsocket/ {
			limit_req zone=RateLimit burst=300 nodelay;
			proxy_pass http://mkwsocketversion;
			#add_header 'Access-Control-Allow-Origin' "*" always;
			#add_header 'Access-Control-Allow-Credentials' 'true' always;
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
		}
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS) {
				add_header 'Access-Control-Max-Age' 1728000;
				add_header 'Content-Type' 'text/plain charset=UTF-8';
				add_header 'Content-Length' 0;
				return 200;
			}
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $connection_upgrade;
			proxy_pass http://mkwsocket;
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
			proxy_redirect off;
			proxy_cache_bypass $http_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-NginX-Proxy true;
			proxy_ssl_session_reuse off;
			#add_header 'Access-Control-Allow-Origin' "*" always;
			#add_header 'Access-Control-Allow-Credentials' 'true' always;
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
		}
	}
	server {
		listen 443 ssl;
		server_name dchart-socket.vndirect.com.vn dchart-socket-staging.vndirect.com.vn;              	
		proxy_next_upstream off;
		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location ~ /dchartsocket/ {
			limit_req zone=RateLimit burst=300 nodelay;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $connection_upgrade;
			if ( $host = 'dchart-socket-staging.vndirect.com.vn' ) {
				proxy_pass http://dchartsocketversionstag;
			}
			if ( $host = 'dchart-socket.vndirect.com.vn' ) {
				proxy_pass http://dchartsocketversion;
			}
			#add_header 'Access-Control-Allow-Origin' "*" always;
			#add_header 'Access-Control-Allow-Credentials' 'true' always;
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
		}
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS) {
				add_header 'Access-Control-Max-Age' 1728000;
				add_header 'Content-Type' 'text/plain charset=UTF-8';
				add_header 'Content-Length' 0;
				return 200;
			}
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $connection_upgrade;
			if ( $host = 'dchart-socket-staging.vndirect.com.vn' ) {
				proxy_pass http://dchartsocketstag;
			}
			if ( $host = 'dchart-socket.vndirect.com.vn' ) {
				proxy_pass http://dchartsocket;
			}
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
			proxy_redirect off;
			proxy_cache_bypass $http_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-NginX-Proxy true;
			proxy_ssl_session_reuse off;
			#add_header 'Access-Control-Allow-Origin' "*" always;
			#add_header 'Access-Control-Allow-Credentials' 'true' always;
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
		}
	}
	server {
		listen 443 ssl;
		server_name dchart-v3-staging.vndirect.com.vn dchart.vndirect.com.vn;              	
		proxy_next_upstream off;
		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location ~ /charting_library {
			limit_req zone=RateLimit burst=300 nodelay;
			if ( $host = 'dchart-v3-staging.vndirect.com.vn' ) {
				proxy_pass http://dchartv3stag;
            }
			if ( $host = 'dchart.vndirect.com.vn' ) {
				proxy_pass http://dchartv3;
            }
			expires +30d;
			proxy_intercept_errors off;                
		}
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS) {
				add_header 'Access-Control-Max-Age' 1728000;
				add_header 'Content-Type' 'text/plain charset=UTF-8';
				add_header 'Content-Length' 0;
				return 200;
			}
			if ( $host = 'dchart-v3-staging.vndirect.com.vn' ) {
				proxy_pass http://dchartv3stag;
            }
			if ( $host = 'dchart-v3.vndirect.com.vn' ) {
				proxy_pass http://dchartv3;
            }
			if ( $host = 'dchart.vndirect.com.vn' ) {
				proxy_pass http://dchartv3;
            }
			#add_header 'Access-Control-Allow-Origin' "*" always;
			#add_header 'Access-Control-Allow-Credentials' 'true' always;
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,Accept-Language' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
		}
	}

	server {
		listen 443 ssl;
		server_name chart-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;


		location / {
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Credentials' 'true'; 
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ( $host = 'chart-api.vndirect.com.vn' ) {
				proxy_pass  http://chartapi;
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken' always;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*';
			add_header 'Access-Control-Allow-Credentials' 'true'; 
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;                        
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
    }


	server {
		listen 443 ssl;
		server_name sentry.vndirect.com.vn;              
		include conf.d/ssl.conf;
		proxy_http_version 1.1;
		
		proxy_set_header   Host                 $http_host;
		proxy_set_header   X-Forwarded-Proto    $scheme;
		proxy_set_header   X-Forwarded-For      $remote_addr;
		proxy_redirect     off;

		# keepalive + raven.js is a disaster
		keepalive_timeout 0;

		# use very aggressive timeouts
		proxy_read_timeout 5s;
		proxy_send_timeout 5s;
		send_timeout 5s;
		client_body_timeout 5s;

		# buffer larger messages
		client_max_body_size 60m;
		client_body_buffer_size 100k;

		#location ~ ^/.*\.(svg|svgz)$ {
			#default_type image/svg+xml;
			#proxy_set_header content-type "image/svg+xml";
			#proxy_hide_header Content-type;
			#add_header Content-type "image/svg+xml";
		#}
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			proxy_pass        http://sentry;
			if ($request_uri ~* .*svg.*) {  
				more_set_headers        "Content-Type:image/svg+xml";
				more_set_headers        "X-Content-Type:OverRidden";
			}
			add_header Strict-Transport-Security "max-age=31536000";
		}
	}
	server {
		listen 443 ssl;
		server_name survey-adm.vndirect.com.vn fundstock-api.vndirect.com.vn fundstock-gw.vndirect.com.vn fundstock.vndirect.com.vn communication-api-int.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 10.40.0.0/19;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			# Allow Truc Khe
			allow 14.162.145.179;
			allow 118.70.15.57;
			allow 27.72.88.12;
			allow 101.99.6.106;
			#Allow Bnh Dng
			allow 45.118.136.134;
			allow 45.118.136.148;
			#Sala
			allow 113.161.44.131;
			allow 115.79.32.104;
			#Vinh
			allow 118.70.52.162;
			#L Vn Lng
			allow 118.70.190.74;
			allow 123.24.205.106;
			deny all;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken,branch-id,token,token-id,X-Force-Signature,X-Auth-Username' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ( $host = 'fundstock-api.vndirect.com.vn' ) {
				proxy_pass http://ccqapi;
            }
			if ( $host = 'fundstock-gw.vndirect.com.vn' ) {
				proxy_pass http://ccqgw;
            }			
			if ( $host = 'fundstock.vndirect.com.vn' ) {
				proxy_pass http://ccqadmin;
            }
			if ( $host = 'communication-api-int.vndirect.com.vn' ) {
				proxy_pass http://10.200.31.129:8080;
            }
			if ( $host = 'survey-adm.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.129:8089;
            }
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,branch-id,token,token-id,X-Force-Signature,X-Auth-Username,x-requested-with' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;  
		}
	}
	server {
		listen 443 ssl;
		server_name id.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		location = /register-account  {
			return 302 https://accounts.vndirect.com.vn;
        }
		location / {
			limit_req zone=RateLimit burst=300 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*' always;
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken, branch-id, token-id, token, MyToken, UserName' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}      
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass  http://vndid-app;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://vndid-appprivate;
			}
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, branch-id, token-id, token' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_hide_header 'Cache-Control';
			proxy_intercept_errors off;
        }
    }
	server {
		listen 443 ssl;
		server_name userid.vndirect.com.vn userid-priv.vndirect.com.vn vndid-int-api.vndirect.com.vn;
		proxy_next_upstream off;        
		include conf.d/ssl.conf;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 10.200.0.0/16;
			allow 10.25.0.0/16;
			allow 202.160.124.0/23;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			# Allow Truc Khe
			allow 14.162.145.179;
			allow 118.70.15.57;
			allow 27.72.88.12;
			allow 101.99.6.106;
			#Allow Bnh Dng
			allow 45.118.136.134;
			allow 45.118.136.148;
			#Sala
			allow 113.161.44.131;
			allow 115.79.32.104;
			#Vinh
			allow 118.70.52.162;
			#L Vn Lng
			allow 118.70.190.74;
			allow 123.24.205.106;
			deny all;

			if ($request_method = 'OPTIONS') {
				add_header 'Access-Control-Allow-Origin' '*' always;
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,sessionid,MyToken,UserName,x-auth-token,X-CSRFToken, branch-id, token-id, token, MyToken, UserName' always;
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			if ( $host = 'userid.vndirect.com.vn' ) {
				proxy_pass http://useridprod;
			}
			if ( $host = 'userid-priv.vndirect.com.vn' ) {
				proxy_pass http://useridpriv;
			}
			if ( $host = 'vndid-int-api.vndirect.com.vn' ) {
				proxy_pass http://vndidprod;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,X-AUTH-USERNAME,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,token-id,x-idempotencykey,x-maker,x-via,branch-id,token,token-id,X-Force-Signature' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;                
		}       
	}
	server {
		listen 443 ssl;
		server_name pricelist.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		default_type application/json;
		
		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location = /webpro/ {
			default_type application/json;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				return 200 '{"hosts": ["https://price-azu-02.vndirect.com.vn","https://price-azu-03.vndirect.com.vn","https://price-viettel-03.vndirect.com.vn","https://price-viettel-04.vndirect.com.vn","https://price-viettel-05.vndirect.com.vn","https://price-cmc-03.vndirect.com.vn","https://price-cmc-04.vndirect.com.vn","https://price-cmc-05.vndirect.com.vn","https://price-cmc-06.vndirect.com.vn","https://price-cmc-07.vndirect.com.vn","https://price-cmc-08.vndirect.com.vn","https://price-cmc-09.vndirect.com.vn","https://price-cmc-10.vndirect.com.vn","https://price-cmc-11.vndirect.com.vn","https://price-cmc-12.vndirect.com.vn","https://price-cmc-13.vndirect.com.vn","https://price-cmc-14.vndirect.com.vn","https://price-vhost-03.vndirect.com.vn","https://price-vhost-04.vndirect.com.vn","https://price-vhost-05.vndirect.com.vn","https://price-vhost-06.vndirect.com.vn","https://price-vhost-07.vndirect.com.vn","https://price-vhost-08.vndirect.com.vn","https://price-vhost-09.vndirect.com.vn","https://price-vhost-10.vndirect.com.vn","https://price-vhost-11.vndirect.com.vn","https://price-vhost-12.vndirect.com.vn","https://price-vhost-13.vndirect.com.vn","https://price-vhost-14.vndirect.com.vn"]}';
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				return 200 '{"hosts": ["https://price-fpt-priv-01.vndirect.com.vn","https://price-fpt-priv-02.vndirect.com.vn"]}';
			}
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
        }
		location = /mobile/ {
			default_type application/json;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				return 200 '{"hosts": ["https://price-azu-01.vndirect.com.vn","https://price-viettel-01.vndirect.com.vn","https://price-viettel-02.vndirect.com.vn","https://price-cmc-01.vndirect.com.vn","https://price-cmc-02.vndirect.com.vn","https://price-vhost-01.vndirect.com.vn","https://price-vhost-02.vndirect.com.vn"]}';
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				return 200 '{"hosts": ["https://price-fpt-priv-01.vndirect.com.vn","https://price-fpt-priv-02.vndirect.com.vn"]}';
			}
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
        }
		location = /priceservicev2/ {
			default_type application/json;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				return 200 '{ "apiUrl": "https://price-api.vndirect.com.vn" }';
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				return 200 '{ "apiUrl": "https://price-api-priv.vndirect.com.vn" }';
			}
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
        }
	}

	server {
		listen 443 ssl;
		server_name contact.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			root /opt/contact;     
		}       
	}
	server {
		listen 443 ssl;
		server_name maintain.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			root /opt/maintain;
		}       
	}
	server {
		listen 80;
		server_name invest.vndirect.com.vn;
		proxy_next_upstream off;                
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			 return 301 https://www.vndirect.com.vn/en/;
		}       
	}
	server {
		listen 443 ssl;
		server_name invest.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		location / {
			 return 301 https://www.vndirect.com.vn/en/;
		}       
	}
	server {
		listen 443 ssl;
		server_name vdi.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location / {
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 10.40.0.0/19;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			# Allow Truc Khe
			allow 14.162.145.179;
			allow 118.70.15.57;
			allow 27.72.88.12;
			allow 101.99.6.106;
			#Allow Bnh Dng
			allow 45.118.136.134;
			allow 45.118.136.148;
			#Sala
			allow 113.161.44.131;
			allow 115.79.32.104;
			#Vinh
			allow 118.70.52.162;
			#L Vn Lng
			allow 118.70.190.74;
			allow 123.24.205.106;
			#deny all;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://guacamole/;
			proxy_buffering off;
			proxy_http_version 1.1;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $http_connection;
			proxy_cookie_path /guacamole/ /;
		}
	}
	server {
		listen 443 ssl;
		server_name vdi-ivnd.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location / {
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 10.40.0.0/19;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			# Allow Truc Khe
			allow 14.162.145.179;
			allow 118.70.15.57;
			allow 27.72.88.12;
			allow 101.99.6.106;
			#Allow Bnh Dng
			allow 45.118.136.134;
			allow 45.118.136.148;
			#Sala
			allow 113.161.44.131;
			allow 115.79.32.104;
			#Vinh
			allow 118.70.52.162;
			#L Vn Lng
			allow 118.70.190.74;
			allow 123.24.205.106;
			deny all;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://guacamoleivnd/;
			proxy_buffering off;
			proxy_http_version 1.1;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $http_connection;
			proxy_cookie_path /guacamole/ /;
		}
	}
	server {
		listen 443 ssl;
		server_name quiz.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location / {
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://10.25.1.62:8080/;
			proxy_http_version 1.1;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $http_connection;
		}
	}
	server {
		listen 443 ssl;
		server_name dlawapi.vndirect.com.vn vnds-fileservice.vndirect.com.vn dlegal.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;

		location / {
			if ($request_method = 'OPTIONS') {
				add_header Access-Control-Allow-Origin '$http_origin';
				add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE, HEAD';
				add_header Access-Control-Max-Age '1728000';
				add_header Access-Control-Allow-Credentials 'true';
				add_header Access-Control-Allow-Headers 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,x-auth-token,X-TRADE-OTP,X-DEVICE-ID,Token-id,X-session-id';
				add_header Content-Type 'text/plain; charset=UTF-8';
				add_header Content-Length '0';
				return 200;
			}
			if ( $host = 'dlawapi.vndirect.com.vn' ) {
					proxy_pass http://10.200.32.137:8080;
			}
			if ( $host = 'vnds-fileservice.vndirect.com.vn' ) {
					proxy_pass http://10.200.32.136:8081;
			}
			if ( $host = 'dlegal.vndirect.com.vn' ) {
				proxy_pass http://10.200.32.136:8000;
		   }
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			#add_header 'Access-Control-Allow-Origin' '*' always;
			#add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,X-AUTH-USERNAME,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,token-id,branch-id' always;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
	}
	server {
		listen 443 ssl;
		server_name dor-stagging.vndirect.com.vn dor.vndirect.com.vn;
		proxy_next_upstream off;                
		include conf.d/ssl.conf;
		
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log; 
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
                proxy_read_timeout  60s;
         	proxy_send_timeout  60s;
        	proxy_connect_timeout 60s;
        	keepalive_timeout   60s;
         	keepalive_requests  10000;
         	send_timeout 60s;
        	client_body_timeout 60s;
        	client_header_timeout 60s;

		location / {
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 10.40.0.0/19;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			# Allow Truc Khe
			allow 14.162.145.179;
			allow 118.70.15.57;
			allow 27.72.88.12;
			allow 101.99.6.106;
			#Allow Bnh Dng
			allow 45.118.136.134;
			allow 45.118.136.148;
			#Sala
			allow 113.161.44.131;
			allow 115.79.32.104;
			#Vinh
			allow 118.70.52.162;
			#L Vn Lng
			allow 118.70.190.74;
			allow 123.24.205.106;
			deny all;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $host = 'dor-stagging.vndirect.com.vn' ) {
				proxy_pass http://10.200.14.30:8080;
			}
			if ( $host = 'dor.vndirect.com.vn' ) {
				proxy_pass http://10.200.14.34:8080;
			}
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,X-AUTH-USERNAME,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,token-id,x-idempotencykey,x-maker,x-via' always;
		}
	}
}
