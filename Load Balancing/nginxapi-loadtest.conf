user  nginx;
worker_processes  auto;
worker_rlimit_nofile 100000;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
	multi_accept on;
	accept_mutex on;
	worker_connections 16384;
}

http {
	more_set_headers 'Server: VNDirect Securities Corporation';
	include       /etc/nginx/mime.types;
	default_type  application/octet-stream;
	log_format main '$http_host ' '$remote_addr [$time_local] ' '"$request" $status $body_bytes_sent ' '"$http_referer" "$http_user_agent" ' '$request_time ' '$upstream_response_time ' 'upstream: $upstream_addr';

	access_log  /var/log/nginx/access.log  main;

	open_file_cache max=200000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;

	sendfile            on;
	tcp_nopush          on;
	tcp_nodelay         on;
	server_tokens       off;
	gzip on;
    gzip_min_length 10240;
    gzip_comp_level 1;
    gzip_vary on;
    gzip_disable msie6;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types
        # text/html is always compressed by HttpGzipModule
        text/css
        text/javascript
        text/xml
        text/plain
        text/x-component
        application/javascript
        application/x-javascript
        application/json
        application/xml
        application/rss+xml
        application/atom+xml
        font/truetype
        font/opentype
        application/vnd.ms-fontobject
        image/svg+xml;
	server_name_in_redirect off;
	server_names_hash_bucket_size 512;
	proxy_buffering     on;
	proxy_buffer_size          256k;
	proxy_buffers              64 256k;
	proxy_busy_buffers_size    256k;
	proxy_temp_file_write_size 2048k;
	proxy_max_temp_file_size    1256m;
	proxy_headers_hash_max_size 2048;
	proxy_headers_hash_bucket_size 1024;
	client_body_buffer_size  512k;
	client_header_buffer_size 512;
	client_max_body_size 16M;
	large_client_header_buffers 64 512k;

	proxy_redirect off;
	proxy_set_header    X-NginX-Proxy true;
	proxy_set_header    Host $host;
	proxy_set_header    X-Real-IP  $remote_addr;
	proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header    X-Forwarded-Proto   $scheme;
	proxy_set_header    X-Forwarded-Host $host;
	proxy_set_header    X-Forwarded-Server $host;
	proxy_pass_header   Set-Cookie;
	proxy_pass_header   X-CSRF-TOKEN;
	proxy_pass_header   X-AUTH-TOKEN;
	proxy_hide_header   X-Powered-By;
	proxy_hide_header   X-AspNet-Version;
	reset_timedout_connection on;
	proxy_read_timeout  30s;
	proxy_send_timeout  30s;
	proxy_connect_timeout 30s;
	keepalive_timeout   30s;
	keepalive_requests  1000;
	send_timeout 30s;
	client_body_timeout 30s;
	client_header_timeout 30s;

	set_real_ip_from 127.0.0.1;
	real_ip_header    X-Forwarded-For;
	real_ip_recursive on;
	
	map $request_method $POSTLimit {
        POST  $binary_remote_addr;
        PUT   $binary_remote_addr;
        PATCH $binary_remote_addr;
        DEL   $binary_remote_addr;
       default "";
    }
    limit_req_zone $POSTLimit zone=POSTLimit:50m rate=25r/s;
    limit_req_zone $binary_remote_addr zone=GETLimit:100m rate=295r/s;
	
	upstream tradeapionline  {
		server 10.200.13.9:80;
		server 10.200.13.10:80;
		server 10.200.13.11:80;
		server 10.200.13.12:80;
		server 10.200.13.13:80;
		server 10.200.13.14:80;
		server 10.200.13.129:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradeapiprivate {
		server 10.200.13.15:80;
		server 10.200.13.16:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradeapimm {
		server 10.200.13.169:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradeapicrossorders {
		server 10.200.13.8:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradeapiint {
		server 10.200.13.15:80;
		server 10.200.13.16:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradereportapi {
		server 10.200.13.142:80;
		server 10.200.13.143:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradereportapiprivate {
		server 10.200.13.134:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradeboapi {
		server 10.200.13.144:80;
		server 10.200.13.145:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream tradeboapiprivate {
		server 10.200.13.135:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream authapi {
		server 10.200.13.22:80;
		server 10.200.13.23:80;
		server 10.200.13.24:80;
		server 10.200.13.199:80;
		server 10.200.13.200:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream authapiprivate {
		server 10.200.13.25:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream sso {
		server 10.200.13.158:5001;
    }
	upstream scco {
        server 10.200.13.158:5000;
    }
	upstream customerapi {
		server 10.200.13.93:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream customerapiprivate {
		server 10.200.13.94:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream customeradmin {
		server 10.200.13.96:9000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream customeradminbeta {
		server 10.200.13.96:9002;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
    upstream adsadmin {
        server 10.200.13.96:9001;
        check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
    }
	upstream autotrade {
		server 10.200.13.20:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream autotradeprivate {
		server 10.200.13.21:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream fdsapi {
		server 10.200.8.6:80;
		server 10.200.8.7:80;
		server 10.200.8.8:80;
		server 10.200.8.9:80;
		server 10.200.8.10:80;
		server 10.200.8.11:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream fdsapiprivate {
		server 10.200.8.12:80;
		server 10.200.8.14:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream fdsapiint {
		server 10.200.8.19:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	#upstream externalcrm {
	#	server 192.168.103.73:8080;
	#	check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	#}
	upstream transactionadmin {
		server 10.200.13.219:8888;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream aniapi {
		server 10.200.13.116:5001;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream anitransaction {
		server 10.200.13.210:5001;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream aniupload {
		server 10.200.13.194:5001;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream watchlist {
		server 10.200.13.81:4000;
		server 10.200.13.82:4000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream watchlistpriv {
		server 10.200.13.163:80;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream i18napi {
		server 10.200.13.90:4000;
		server 10.200.13.91:4000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream i18nprivate {
		server 10.200.13.92:4000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	upstream i18nadmin {
		server 10.200.13.92:3000;
		check interval=10000 rise=1 fall=3 timeout=2000 type=tcp;
	}
	server {
		listen          80 reuseport;
		server_name    product-api.vndirect.com.vn whitelabel-report-api.vndirect.com.vn trade-api-wl.vndirect.com.vn watchlist-api.vndirect.com.vn i18n-api.vndirect.com.vn i18n-admin.vndirect.com.vn transaction-admin.vndirect.com.vn ani-transaction-api.vndirect.com.vn ani-api.vndirect.com.vn ani-upload-api.vndirect.com.vn wl-auth-api.vndirect.com.vn tradeapi-mm.vndirect.com.vn trade-api.vndirect.com.vn auth-api.vndirect.com.vn customer-api.vndirect.com.vn trade-api-int.vndirect.com.vn externalcrm.vndirect.com.vn auth-beta-api.vndirect.com.vn trade-report-api.vndirect.com.vn trade-bo-api.vndirect.com.vn ads-admin.vndirect.com.vn customer-admin.vndirect.com.vn customer-profile.vndirect.com.vn bpm-ani2.vndirect.com.vn;
		proxy_next_upstream off;
		access_log  /var/log/nginx/access.log  main;
		error_log   /var/log/nginx/error.log;

		location /nginx_status {
			stub_status on;
			access_log   off;
			allow 127.0.0.1;
			allow 10.0.0.0/8;
			allow 192.168.0.0/16;
			allow 202.160.124.0/24;
			allow 202.160.125.0/24;
			deny all;
		}
		
		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			return 301 https://$host$request_uri;
			proxy_send_timeout  60s;
			#add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name     wl-auth-api.vndirect.com.vn;
		include conf.d/ssl.conf;

		access_log  /var/log/nginx/access.log  main;

		error_page 500 502 503 504 408 403 400 404 /authapierrorpage.html;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
		#more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location = /authapierrorpage.html {
					root /var/www/nginx/;
					access_log off;
					expires 30d;
		}

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://10.200.13.193:8080;
			#return 503;
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name     auth-api.vndirect.com.vn;
		include conf.d/ssl.conf;

		access_log  /var/log/nginx/access.log  main;

		error_page 500 502 503 504 408 403 400 404 /authapierrorpage.html;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,Token-id,X-session-id';
		#more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location = /authapierrorpage.html {
					root /var/www/nginx/;
					access_log off;
					expires 30d;
		}
		location ~ ^/v3/session_auth {
			#if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
			#	return 503;
			#}
			#if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
			#	return 503;
			#}
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,Token-id,X-session-id';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			proxy_pass http://authapiprivate;
			#return 503;
			error_page 500 502 504 408 403 400 404 /authapierrorpage.html;
			proxy_intercept_errors off;
		}
		location / {
			#if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
			#	return 503;
			#}
			#if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
			#	return 503;
			#}
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,Token-id,X-session-id';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://authapi;
				#return 503;
				error_page 500 502 504 408 403 400 404 /authapierrorpage.html;
			}

			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://authapiprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /authapierrorpage.html;
			}
			proxy_intercept_errors off;
		}
		location ^~ /sso {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = OPTIONS ) {
				#add_header 'Access-Control-Allow-Origin' '*';
				#add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				#add_header 'Access-Control-Allow-Headers' 'Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security' always;
				#add_header Access-Control-Allow-Headers "Authorization, x-auth-token";
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			rewrite ^/sso(/.*)$ $1 break;
			add_header 'X-Channel' '$http_channel' always;
			proxy_pass http://sso;
			#return 503;
			error_page 500 502 504 408 403 400 404 /authapierrorpage.html;
		}
		location ^~ /scco {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = OPTIONS ) {
				#add_header 'Access-Control-Allow-Origin' '*';
				#add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				#add_header 'Access-Control-Allow-Headers' 'Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security' always;
				#add_header Access-Control-Allow-Headers "Authorization, x-auth-token";
				add_header Content-Length 0;
				add_header Content-Type text/plain;
				return 200;
			}
			rewrite ^/scco(/.*)$ $1 break;
			add_header 'X-Channel' '$http_channel' always;
			proxy_pass http://scco;
			#return 503;
			error_page 500 502 504 408 403 400 404 /authapierrorpage.html;
		}
		location ~ ^(/v2/internal|/internal)$ {
			allow 10.200.13.95;
			deny all;
			proxy_pass http://authapi;
			#return 503;
			error_page 500 502 504 408 403 400 404 /authapierrorpage.html;
		}
	}
	
	server {
		listen          443 ssl fastopen=3 reuseport;
		server_name trade-api.vndirect.com.vn trade-api-int.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;
		underscores_in_headers on;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location = /tradeapierrorpage.html {
			root /var/www/nginx/;
			access_log off;
			expires 30d;
		}
		
		location ~ ^/autotrade/ {
			#limit_req zone=GETLimit burst=300 nodelay;
			#limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			# limit_except GET OPTIONS {
				# deny all;
			# }
			if ( $host = 'trade-api.vndirect.com.vn' ) {
				set $filter TradeApi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				set $filter TradeApiPrivate;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_channel = "V" ){
				set $cfilter "ProTrade";
			}
			if ( $http_origin = "https://www.vndirect.com.vn" ){
				set $filter "${filter}Online";
				set $cfilter "Online";
			}
			if ($http_origin ~* (https://banggia.vndirect.com.vn|https://banggia-hn.vndirect.com.vn|https://banggia-hcm.vndirect.com.vn|https://banggia-as.vndirect.com.vn|https://banggia-na.vndirect.com.vn|https://banggia-eu.vndirect.com.vn)){ 
				set $filter "${filter}Smartboard";
				set $cfilter "Stockboard";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://trade-eu.vndirect.com.vn|https://vntrade.fnsyrus.com|https://protrade-staging.vndirect.com.vn)){
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $filter ~ "^(TradeApi|TradeApiOnline|TradeApiSmartboard|TradeApiProTrade)$" ){
				#proxy_pass http://autotrade;
				return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $filter ~ "^(TradeApiPrivate|TradeApiPrivateOnline|TradeApiPrivateSmartboard|TradeApiPrivateProTrade)$" ){
				proxy_pass http://autotradeprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
		location  ~ ^/accounts/.*/autotrade/ {
			#limit_req zone=GETLimit burst=300 nodelay;
			#limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			# limit_except GET OPTIONS {
				# deny all;
			# }
			if ( $host = 'trade-api.vndirect.com.vn' ) {
				set $filter TradeApi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				set $filter TradeApiPrivate;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_channel = "V" ){
				set $cfilter "ProTrade";
			}
			if ( $http_origin = "https://www.vndirect.com.vn" ){
				set $filter "${filter}Online";
				set $cfilter "Online";
			}
			if ($http_origin ~* (https://banggia.vndirect.com.vn|https://banggia-hn.vndirect.com.vn|https://banggia-hcm.vndirect.com.vn|https://banggia-as.vndirect.com.vn|https://banggia-na.vndirect.com.vn|https://banggia-eu.vndirect.com.vn)){ 
				set $filter "${filter}Smartboard";
				set $cfilter "Stockboard";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://trade-eu.vndirect.com.vn|https://vntrade.fnsyrus.com|https://protrade-staging.vndirect.com.vn)){
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $filter ~ "^(TradeApi|TradeApiOnline|TradeApiSmartboard|TradeApiProTrade)$" ){
				#proxy_pass http://autotrade;
				return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $filter ~ "^(TradeApiPrivate|TradeApiPrivateOnline|TradeApiPrivateSmartboard|TradeApiPrivateProTrade)$" ){
				proxy_pass http://autotradeprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
		location  ~ ^/accounts/.*/crossorders/ {
			#limit_req zone=GETLimit burst=300 nodelay;
			#limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			# limit_except GET OPTIONS {
				# deny all;
			# }
			
			if ( $host = 'trade-api.vndirect.com.vn' ) {
				set $filter TradeApi;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_channel = "V" ){
				set $cfilter "ProTrade";
			}
			if ( $http_origin = "https://www.vndirect.com.vn" ){
				set $filter "${filter}Online";
				set $cfilter "Online";
			}
			if ($http_origin ~* (https://banggia.vndirect.com.vn|https://banggia-hn.vndirect.com.vn|https://banggia-hcm.vndirect.com.vn|https://banggia-as.vndirect.com.vn|https://banggia-na.vndirect.com.vn|https://banggia-eu.vndirect.com.vn)){ 
				set $filter "${filter}Smartboard";
				set $cfilter "Stockboard";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://trade-eu.vndirect.com.vn|https://protrade-staging.vndirect.com.vn)){
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			proxy_pass http://tradeapicrossorders;
			#return 503;
			error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
		location ~ ^/accounts/.*/orders/new_order_requests {
			#limit_req zone=GETLimit burst=300 nodelay;
			#limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			# limit_except GET OPTIONS {
				# deny all;
			# }

			if ( $host = 'trade-api.vndirect.com.vn' ) {
				set $filter TradeApi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				set $filter TradeApiPrivate;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_channel = "V" ){
				set $cfilter "ProTrade";
			}
			if ( $http_origin = "https://www.vndirect.com.vn" ){
				set $filter "${filter}Online";
				set $cfilter "Online";
			}
			if ($http_origin ~* (https://banggia.vndirect.com.vn|https://banggia-hn.vndirect.com.vn|https://banggia-hcm.vndirect.com.vn|https://banggia-as.vndirect.com.vn|https://banggia-na.vndirect.com.vn|https://banggia-eu.vndirect.com.vn)){ 
				set $filter "${filter}Smartboard";
				set $cfilter "Stockboard";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://protrade-staging.vndirect.com.vn)){
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $filter ~ "^(TradeApi|TradeApiOnline|TradeApiSmartboard|TradeApiProTrade)$" ){
				#proxy_pass http://tradeapionline;
				return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $filter ~ "^(TradeApiPrivate|TradeApiPrivateOnline|TradeApiPrivateSmartboard|TradeApiPrivateProTrade)$" ){
				#proxy_pass http://tradeapiprivate;
				proxy_pass http://tradeapionline;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $host = 'trade-api-int.vndirect.com.vn' ){
				proxy_pass  http://tradeapiint;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
		location / {
			#limit_req zone=GETLimit burst=300 nodelay;
			#limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			# limit_except GET OPTIONS {
				# deny all;
			# }
			if ( $host = 'trade-api.vndirect.com.vn' ) {
				set $filter TradeApi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				set $filter TradeApiPrivate;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_origin = "https://www.vndirect.com.vn" ){
				set $filter "${filter}Online";
				set $cfilter "Online";
			}
			if ($http_origin ~* (https://banggia.vndirect.com.vn|https://banggia-hn.vndirect.com.vn|https://banggia-hcm.vndirect.com.vn|https://banggia-as.vndirect.com.vn|https://banggia-na.vndirect.com.vn|https://banggia-eu.vndirect.com.vn)){ 
				set $filter "${filter}Smartboard";
				set $cfilter "Stockboard";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://trade-eu.vndirect.com.vn|https://protrade-staging.vndirect.com.vn)){
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";                        
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $filter ~ "^(TradeApi|TradeApiOnline|TradeApiSmartboard|TradeApiProTrade)$" ){
				proxy_pass http://tradeapionline;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $filter ~ "^(TradeApiPrivate|TradeApiPrivateOnline|TradeApiPrivateSmartboard|TradeApiPrivateProTrade)$" ){
				proxy_pass http://tradeapiprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $host = 'trade-api-int.vndirect.com.vn' ){
				proxy_pass  http://tradeapiint;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
	}
	
	server {
		listen          443 ssl;
		server_name tradeapi-mm.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		#more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location / {
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			allow 127.0.0.1;
			allow 10.25.0.0/16;
			allow 10.26.0.0/16;
			allow 10.27.0.0/16;
			allow 10.28.0.0/16;
			allow 10.40.0.0/19;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			#Bualuang
			allow 49.231.7.192/27;
			allow 58.82.138.0/28;
			allow 61.90.139.96/29;
			allow 119.110.232.96/28;
			deny all;
			proxy_pass  http://tradeapimm;
			proxy_intercept_errors off;
		}
	}
	server {
		listen          443 ssl;
		server_name trade-api-wl.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		#more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location / {
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			allow 127.0.0.1;
			allow 10.25.0.0/16;
			allow 10.26.0.0/16;
			allow 10.27.0.0/16;
			allow 10.28.0.0/16;
			allow 10.40.0.0/19;
			allow 10.200.0.0/16;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			#Bualuang
			allow 49.231.7.192/27;
			allow 58.82.138.0/28;
			allow 61.90.139.96/29;
			allow 119.110.232.96/28;
			deny all;
			proxy_pass  http://10.200.13.17:80;
			proxy_intercept_errors off;
		}
	}

	server {
		listen          443 ssl;
		server_name customer-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://customerapi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://customerapiprivate;
			}
			proxy_intercept_errors off;
		}
	}

	server {
		listen          443 ssl;
		server_name customer-admin.vndirect.com.vn customer-profile.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ( $host ~ "^(customer-admin.vndirect.com.vn|customer-profile.vndirect.com.vn)$" ) {
				proxy_pass http://customeradmin;
			}
			if ( $host = "customer-profile-beta.vndirect.com.vn" ) {
				proxy_pass http://customeradminbeta;
			}
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name ads-admin.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;


		location / {
				proxy_hide_header 'Cache-Control';
				add_header 'Access-Control-Max-Age' 600;
				add_header 'Access-Control-Allow-Credentials' 'true';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
				add_header Cache-Control "private, no-cache, no-store, must-revalidate";
				proxy_intercept_errors off;

				if ( $host = "ads-admin.vndirect.com.vn" ) {
						proxy_pass http://adsadmin;
				}
		}
		allow 10.40.24.216;
		allow 10.40.24.159;
		allow 10.40.17.101;
		allow 192.168.69.4;
		allow 103.238.68.163;
		allow 118.70.129.31;
		allow 203.128.245.222;
		allow 14.160.32.66;
		allow 103.37.29.134;
		allow 202.160.124.0/24;
		allow 202.160.125.0/24;
		deny all;
    }

	server {
		listen          80;
		server_name     fds-api.vndirect.com.vn fds-api-int.vndirect.com.vn fds-api-suat3.vndirect.com.vn;
		proxy_next_upstream off;                
		access_log  /var/log/nginx/access.log  main;
		error_log   /var/log/nginx/error.log;  
		
		location / {
			return 301 https://$host$request_uri;
		}       
    }
	server {
		listen 443 ssl;
		server_name     fds-api.vndirect.com.vn;
		include conf.d/ssl.conf;
		proxy_next_upstream off;
		proxy_set_header Sec-CH-UA "";

		access_log  /var/log/nginx/access.log  main;

		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		charset utf-8;
		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://fdsapi;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://fdsapiprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_intercept_errors off;
		}
	}

	server {
		listen 443 ssl;
		server_name     fds-api-int.vndirect.com.vn;
		include conf.d/ssl.conf;
		proxy_next_upstream off;
		
		access_log  /var/log/nginx/access.log  main;
		
		error_page 500 502 503 504 408 403 400 404 /errorpage.html;
		
		charset utf-8; 
		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true'; 
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location / {                        
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';                                
				more_set_headers 'Access-Control-Max-Age: 1728000';                                
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';                                
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';                                
				more_set_headers 'Content-Length: 0';                                
				return 200;                        
			}       
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {                                
				proxy_pass http://fdsapiint;
				#return 503;
				#error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}                               
			proxy_intercept_errors off;
        }
		allow 10.200.0.0/16;
		allow 192.168.69.5/32;
		allow 192.168.103.0/24;
		allow 202.160.124.0/24;
		allow 202.160.125.0/24;
		deny all;
    }
	
	server {
		listen          443 ssl;
		server_name trade-bo-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;
		underscores_in_headers on;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location = /tradeapierrorpage.html {
			root /var/www/nginx/;
			access_log off;
			expires 30d;
		}

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}

			if ( $host = 'trade-bo-api.vndirect.com.vn' ) {
				set $filter TradeBOApi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				set $filter TradeBOApiPrivate;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://trade-eu.vndirect.com.vn|https://protrade-staging.vndirect.com.vn|https://fundstockclient.vndirect.com.vn)) {
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";                        
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $filter ~ "^(TradeBOApi|TradeBOApiOnline|TradeBOApiProTrade)$" ){
				proxy_pass http://tradeboapi;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $filter ~ "^(TradeBOApiPrivate|TradeBOApiPrivateOnline|TradeBOApiPrivateProTrade)$" ){
				proxy_pass http://tradeboapiprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
	}
	server {
		listen          443 ssl;
		server_name trade-report-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;
		underscores_in_headers on;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;
		
		charset utf-8;

		more_set_headers 'Access-Control-Allow-Origin: *';
		more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
		more_set_headers 'Access-Control-Allow-Credentials: true';
		more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
		more_set_headers 'Cache-Control: private, no-cache, no-store, must-revalidate';

		location = /tradeapierrorpage.html {
			root /var/www/nginx/;
			access_log off;
			expires 30d;
		}

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			proxy_next_upstream off;
			proxy_set_header  X-Real-IP $remote_addr;
			proxy_set_header  X-AGENT $http_user_agent;
			proxy_set_header  X-REFERER $http_referer;
			
			if ($request_method = 'OPTIONS') {
				more_set_headers 'Access-Control-Allow-Origin: *';
				more_set_headers 'Access-Control-Allow-Methods: GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH';
				more_set_headers 'Access-Control-Max-Age: 1728000';
				more_set_headers 'Access-Control-Allow-Credentials: true';
				more_set_headers 'Access-Control-Allow-Headers: X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,X-DEVICE-ID,X-TRADE-OTP';
				more_set_headers 'Content-Type: text/plain; charset=UTF-8';
				more_set_headers 'Content-Length: 0';
				return 200;
			}

			if ( $host = 'trade-report-api.vndirect.com.vn' ) {
				set $filter TradeReportApi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				set $filter TradeReportApiPrivate;
			}
			if ( $http_channel = F ){
				set $cfilter "Floor";
			}
			if ( $http_channel = T ){
				set $cfilter "Tele";
			}
			if ( $http_channel = B ){
				set $cfilter "Bd";
			}
			if ( $http_origin ~* (https://trade.vndirect.com.vn|https://trade-hn.vndirect.com.vn|https://trade-hcm.vndirect.com.vn|https://trade-as.vndirect.com.vn|https://trade-na.vndirect.com.vn|https://trade-eu.vndirect.com.vn|https://protrade-staging.vndirect.com.vn|https://fundstockclient.vndirect.com.vn)) {
				set $filter "${filter}ProTrade";
				set $cfilter "ProTrade";                        
			}
			if ( $http_user_agent ~ "^(VndirectIOSApp)(.*)?$" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $http_user_agent = "VndirectDesktopApp" ) {
				set $filter "${filter}Online";
				set $cfilter "Dolfin";
			}
			if ( $http_channel = P ) {
				set $cfilter "Dolfin";
			}
			if ( $http_user_agent = "VndirectAndroidApp-v1.1" ) {
				set $filter "${filter}Online";
				set $cfilter "Mobile";
			}
			if ( $filter ~ "^(TradeReportApi|TradeReportApiOnline|TradeReportApiProTrade)$" ){
				proxy_pass http://tradereportapi;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			if ( $filter ~ "^(TradeReportApiPrivate|TradeReportApiPrivateOnline|TradeReportApiPrivateProTrade)$" ){
				proxy_pass http://tradereportapiprivate;
				#return 503;
				error_page 500 502 504 408 403 400 404 /tradeapierrorpage.html;
			}
			proxy_set_header 'http_channel' '$cfilter';
			add_header 'X-Channel' '$http_channel' always;
			proxy_intercept_errors off;
		}
	}
	
	server {
		listen 443 ssl;
		server_name i18n-admin.vndirect.com.vn transaction-admin.vndirect.com.vn ani-api.vndirect.com.vn ani-upload-api.vndirect.com.vn ani-transaction-api.vndirect.com.vn bpm-ani2.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		location ~ / {  
			allow 127.0.0.1;
			allow 10.25.0.0/16;
			allow 10.26.0.0/16;
			allow 10.27.0.0/16;
			allow 10.28.0.0/16;
			allow 10.40.0.0/19;
			allow 10.200.0.0/16;
			allow 202.160.125.0/24;
			allow 202.160.124.0/24;
			allow 202.160.124.251;
			allow 192.168.0.0/16;
			allow 192.168.142.0/24;
			allow 192.168.143.0/24;
			allow 192.168.144.0/24;
			allow 192.168.145.0/24;
			#Allow Public HCM
			allow 103.238.72.45;
			allow 113.161.65.54;
			allow 115.78.164.78;
			allow 14.161.26.127;
			allow 183.91.28.240;
			allow 210.245.36.131;
			#Allow Public HN
			allow 103.238.68.163;
			allow 118.70.129.31;
			allow 103.37.29.134;
			allow 203.128.245.222;
			allow 14.160.32.66;
			#Allow Public DN
			allow 113.160.224.226;
			deny all;
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,MyToken,UserName,If-Modified-Since,vOrigin' always;
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			proxy_intercept_errors off;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'MyToken, UserName, Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security,vOrigin' always;
				#add_header Content-Length 0;
				#add_header Content-Type text/plain;
				return 200;
			}
			if ( $host = "transaction-admin.vndirect.com.vn" ) {
					proxy_pass http://transactionadmin;
			}
			if ( $host = "i18n-admin.vndirect.com.vn" ) {
					proxy_pass http://i18nadmin;
			}
			if ( $host = "ani-api.vndirect.com.vn" ) {
					add_header 'Access-Control-Allow-Origin' '*' always;
					add_header Access-Control-Allow-Headers 'MyToken, UserName, Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security,vOrigin' always;
					proxy_pass http://aniapi;
			}
			if ( $host = "ani-transaction-api.vndirect.com.vn" ) {
					add_header 'Access-Control-Allow-Origin' '*' always;
					add_header Access-Control-Allow-Headers 'MyToken, UserName, Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security,vOrigin' always;
					proxy_pass http://anitransaction;
			}
			if ( $host = "ani-upload-api.vndirect.com.vn" ) {
					add_header 'Access-Control-Allow-Origin' '*' always;
					add_header Access-Control-Allow-Headers 'MyToken, UserName, Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security,vOrigin' always;
					proxy_pass http://aniupload;
			}
			if ( $host = "bpm-ani2.vndirect.com.vn" ) {
					add_header 'Access-Control-Allow-Origin' '*' always;
					add_header Access-Control-Allow-Headers 'MyToken, UserName, Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security,vOrigin' always;
					proxy_pass http://10.200.13.214:8080;
			}
		}
	}
	server {
		listen 443 ssl;
		server_name i18n-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security' always;
				#add_header Content-Length 0;
				#add_header Content-Type text/plain;
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://i18napi;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://i18nprivate;
			}
			more_set_headers 'Access-Control-Expose-Headers: X-Total-Count';
			proxy_hide_header 'Cache-Control';
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			add_header Cache-Control "public";
			expires 1h;
			proxy_intercept_errors off;
		}
	}
	server {
		listen 443 ssl;
		server_name watchlist-api.vndirect.com.vn;
		proxy_next_upstream off;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, MyToken, UserName' always;
				#add_header Content-Length 0;
				#add_header Content-Type text/plain;
				return 200;
			}
			if ($remote_addr !~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://watchlist;
			}
			if ($remote_addr ~ "^(10\.\d{1,3}\.\d{1,3}\.\d{1,3}|202\.160\.124\.\d{1,3}|202\.160\.125\.\d{1,3}|192\.168\.\d{1,3}\.\d{1,3}|103\.238\.72\.45|113\.161\.65\.54|115\.78\.164\.78|14\.161\.26\.127|103\.238\.68\.163|118\.70\.129\.31|103\.37\.29\.134|113\.160\.224\.226|203\.128\.245\.222|14\.160\.32\.66)$") {
				proxy_pass http://watchlistpriv;
			}
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;                                            
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, MyToken, UserName' always;                                
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";   
			proxy_intercept_errors off;
		}
	}
	server {
		listen 443 ssl;
		server_name whitelabel-report-api.vndirect.com.vn;
		proxy_next_upstream off;
		proxy_read_timeout  600s;
		proxy_send_timeout  600s;
		proxy_connect_timeout 600s;
		keepalive_timeout   600s;
		send_timeout 600s;
		client_body_timeout 200s;
		client_header_timeout 200s;

		include conf.d/ssl.conf;

		#expires +30d;
		root /var/www/nginx/;
		access_log            /var/log/nginx/access.log main;
		error_log             /var/log/nginx/error.log;

		location / {
			limit_req zone=GETLimit burst=300 nodelay;
			limit_req zone=POSTLimit burst=30 nodelay;
			if ($request_method = OPTIONS ) {
				add_header 'Access-Control-Allow-Origin' '*';
				add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, MyToken, UserName' always;
				#add_header Content-Length 0;
				#add_header Content-Type text/plain;
				return 200;
			}
			proxy_pass http://10.200.13.217:8080;
			add_header 'Access-Control-Max-Age' 600;
			add_header 'Access-Control-Allow-Origin' '*' always;
			add_header 'Access-Control-Allow-Credentials' 'true';
			add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;                                            
			add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since, MyToken, UserName' always;                                
			add_header Cache-Control "private, no-cache, no-store, must-revalidate";   
			proxy_intercept_errors off;
		}
	}
	# server {
		# listen 443 ssl;
		# server_name product-api.vndirect.com.vn;
		# proxy_next_upstream off;

		# include conf.d/ssl.conf;

		# #expires +30d;
		# root /var/www/nginx/;
		# access_log            /var/log/nginx/access.log main;
		# error_log             /var/log/nginx/error.log;

		# location ~ ^/api-admin/(.*)$ {
			# if ($request_method = OPTIONS ) {
					# add_header 'Access-Control-Allow-Origin' '*';
					# add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
					# add_header 'Access-Control-Allow-Headers' 'Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security' always;
					# add_header Content-Length 0;
					# add_header Content-Type text/plain;
					# return 200;
			# }
			# proxy_hide_header 'Cache-Control';
			# add_header 'Access-Control-Allow-Origin' '*' always;
			# add_header 'Access-Control-Max-Age' 600;
			# add_header 'Access-Control-Allow-Credentials' 'true';
			# add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
			# add_header 'Access-Control-Allow-Headers' 'X-Real-IP,X-AGENT,X-REFERER,X-AUTH-TOKEN,Accept-Encoding,channel,X-XSS-Protection,X-Content-Type-Options,Strict-Transport-Security,Content-Type,Authorization,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since' always;
			# add_header Cache-Control "private, no-cache, no-store, must-revalidate";
			# proxy_intercept_errors off;
			# proxy_pass  http://10.200.13.97:8080;
		# }
		# location  / {
				# add_header 'Access-Control-Allow-Origin' '*';
				# add_header 'Access-Control-Allow-Methods' 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS, PATCH' always;
				# add_header 'Access-Control-Allow-Headers' 'Content-Type, Origin, X-AUTH-TOKEN, Cache-Control , channel , X-XSS-Protection , X-Content-Type-Options , Strict-Transport-Security' always;
				# add_header Content-Length 0;
				# add_header Content-Type text/plain;
				# return 200;
		# }
	# }
}
